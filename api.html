<!DOCTYPE html>
<html>
  <head>
    <script src="javascripts/jquery-1.9.1.min.js"></script>
    <script src="https://raw.github.com/fkling/JSNetworkX/master/jsnetworkx.js"></script>
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="stylesheets/api.css" rel="stylesheet" media="screen">
    <script src="javascripts/bootstrap.min.js"></script>
    <script src="javascripts/d3.v2.min.js"></script>
    <script src="javascripts/wont_implement.js"></script>
  </head>
  <body>
    <div id="main" class="accordion"></div>
    <script>
      var elements = {};
      $.getJSON('networkx_api.json', function(api) {
        $.each(api.modules.slice(1), function(i, m) {
          genererate_output(m.replace('networkx', 'jsnx'));
        });

        $.each(api.types, function(i, t) {
          var m = t[0].replace('networkx', 'jsnx');
          var n = t[1].replace('NetworkX', 'JSNetworkX');
          var e = exists(m, n);
          var ele = $('<div />', {
            'class': 'exec type' + (e ? ' implemented' : ''),
            'text': n
          }).appendTo(elements[m]);
          if (t[2]) {
            ele.clone()
            .toggleClass('implemented', exists('', n))
            .appendTo(elements['jsnx']);
          }
        });
        $.each(api.functions, function(i, t) {
          var m = t[0].replace('networkx', 'jsnx');
          var e = exists(m, t[1]);
          var ele = $('<div />', {
            'class': 'exec' + (e ? ' implemented' : ''),
            'text': t[1]
          }).appendTo(elements[m]);
          ele.toggleClass('wont', (wont_implement.indexOf([m, t[1]].join('.')) > -1 ? ' wont' : '') || ele.closest('.wont').length === 1);
          if (t[2]) {
            ele.clone()
            .toggleClass('implemented', exists('', t[1]))
            .appendTo(elements['jsnx']);
          }
        });

        var color = d3.scale.linear()
        .domain([0,100])
        .range(['#DDDDDD', '#AAFFAA']);
        $.each(elements, function(n, $ele) {
          if ($(this).closest('.wont').length > 0) {
            return;
          }
          var $exec = $ele.find('.exec').filter(function() {
            return $(this).closest('.wont').length === 0;
          });
          var total = $exec.length;
          var impl = $exec.filter('.implemented').length;
          var p = Math.floor(impl / total * 100);
          $ele.parent().prev().css('background-color', color(p))
          .find('a').append($('<span />',{
            text: ' ' + p + '% implemented',
            'class': 'impl_info'
          }));
        });
      });

      function exists(m, n) {
        var parts = m.split('.').slice(1);
        m = jsnx;
        while (parts.length && (m = m[parts.shift()]));
        return !!(m && n in m);
      }

      function genererate_output(m) {
        var top = m.lastIndexOf('.') === -1;
        if (!top) {
          var parent = m.substr(0, m.lastIndexOf('.'));
          if (!(parent in elements) ) {
            genererate_output(parent);
          }
        }
        var cm = m.replace(/\./g, '_');
        var $ele = $('<div />', {
          'class': 'accordion-group' + (wont_implement.indexOf(m) > -1 ? ' wont' : '')
        });
        var $header = $('<div />', {
          'class': 'accordion-heading',
          'html': '<a class="accordion-toggle" href="#' + cm + '_body' + '" data-toggle="collapse">' + m.substring(m.lastIndexOf('.') + 1)+ '<\/a>'
        }).appendTo($ele);
        var $body = $('<div />', {'class': 'accordion-inner'}).appendTo(
          $('<div />', {
            'class': 'accordion-body collapse accordion' + (top ? ' in' : ''),
            id: cm + '_body'}
          ).appendTo($ele)
        );

        elements[m] = $body;
        $ele.appendTo(top ? '#main' : elements[parent]);
      }

    </script>
  </body>
</html>
